databases:
  - name: allocraft-db
    plan: free
    # Free-tier Postgres on Render â€” 1 GB storage, 1 CPU, shared instance.
    # Connection string is injected automatically via fromDatabase below.

services:
  - type: web
    name: allocraft-backend
    env: python
    plan: free
    # rootDir is the working directory for both build and runtime commands.
    rootDir: fastapi_project
    # Install Python dependencies from the repo root requirements.txt.
    buildCommand: pip install -r ../requirements.txt
    # Apply pending Alembic migrations first, then start the server.
    startCommand: python -m alembic upgrade head && uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: FRONTEND_ORIGINS
        value: https://allocraft-lite.onrender.com,https://allocraft-lite-dev.onrender.com,http://localhost:5173
      - key: SECRET_KEY
        generateValue: true
      - key: DATABASE_URL
        # Postgres connection string injected from the managed database above.
        fromDatabase:
          name: allocraft-db
          property: connectionString

